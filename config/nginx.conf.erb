# Prerequisites: ngx_http_ssl_module and ngx_http_proxy_module should be enabled

# Step 1: set up normal server with HTTPS https://letsencrypt.org/
# Step 2: set up proxy settings as shown below 
# Step 3: set custom domain in Intercom Help Center settings
# Step 4: make sure your DNS record is configured to IP of your Nginx server

worker_processes <%= ENV['NGINX_WORKERS'] || 2 %>;
error_log /dev/stdout info;
daemon off;

events {
	use epoll;
	accept_mutex on;
	worker_connections 256;
}

http {
  server {
    listen <%= ENV["PORT"] %>;
    server_name support.ecademy-learning.com; # replace this with your domain

    location / {
      # using "set" is important as IP addresses of Intercom servers 
      # changes dynamically. "set" enables nginx to follow dynamic IPs
      set $intercom "https://custom.intercom.help:443"; 
      proxy_set_header Host $host;
      proxy_pass $intercom;
    }
  }
}
